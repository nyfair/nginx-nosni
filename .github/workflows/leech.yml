name: leech

on:
  push:
    paths:
    - '.github/workflows/leech.yml'

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        url:
        - https://mega.nz/file/cTlBhaqb#rQQ774YBReqkiUYVbV9vRDw8szGn35C7YjQ7k40nMiA
        - https://mega.nz/file/VS0AHI6Z#cfzzOMU57wwQAx5vOWOeePwmO73jIQPHF0r6fbihVpo
        - https://mega.nz/file/5eEGHSYR#YJAt9WphA8Ob4ulfCo012FErLuGw3f1obm2iFnZBz8I
        - https://mega.nz/file/pe1CRLLT#GmhkHHP4jsBnLbw4aGvuxxJNcyC_6lrnt9f0nzOMm-U
        - https://mega.nz/file/NSV2WYSD#idAAXmNs7PJiQL-r9uiW7ZMPTRCkl3HA1Sr6Ddvalqw
        - https://mega.nz/file/xe9lQaJC#KtUo57OhNQR46dWC2mxqLA76A7iV0MEi0aIqGswoOYg
        - https://mega.nz/file/AbFjGTaY#pi522rLMtNCAmxOC1gUjb66CXcsu-fyCVlAZBZOWqoc
        - https://mega.nz/file/sO0XxSrK#Fv3Fw6F_VKD_pj8K3A_Eg8y1Gi2bKq0FgSif_rlBpkM
        - https://mega.nz/file/lbkQACpb#9imvrFtsiAuCfdHu45Wtjzvb4b77FcGRB740oH391-I
        - https://mega.nz/file/lP8jCCZS#CpPl3yihucQKPnC9iNV53bU6c2yRhov9A0QC0KJq18M
        - https://mega.nz/file/sGEEjCRI#HDOkyYcQqZE4yrqQwp8WC0dADL_ynTIrRUse4ACIg0o
        - https://mega.nz/file/8K9ADI4I#kA-0CDC5T4h3Slu3ACAC_z_XQZB79THRrkLOYq0Gbuc
        - https://mega.nz/file/hbNiVaLD#Io0khwlKF2ally5S5TokHRD5isk1rFimAZUaxF1DE_k
        - https://mega.nz/file/MH9FmQBA#IETgfzmYb1QDKPk_uH_Z4gRfk72OybggLuUzBTgrURc
        - https://mega.nz/file/Ffc2BYga#Cv2SvSoZMwQhI8ZRlgtd4r6IMNvOypHxc21QB0RN1_s
        - https://mega.nz/file/wOEygSRb#sGW6frX7p0RMZtgeXcaEJgM6STEgXKK84W1ivAp7S2E
        - https://mega.nz/file/tPU1WA6Q#5TLcjDbEic0x4jUIhxfzwhBJdS24N3JZYeSjBiifL1A
        - https://mega.nz/file/FG0k2a4R#635cSerj85WCl5UeMP-aAUeuvLvyunnzxWnxpMZ0BuU
        - https://mega.nz/file/9eNETYpS#tDuZWMKLJ_Qt76gji1Z-xQ2Bj7vNsRvJpAtP2OMJvxM
        - https://mega.nz/file/FC1XTbxJ#dn7AkiJdEVLgbhjRXixK-IMFmGrSUk3jMJAlrbdRz24
        - https://mega.nz/file/IfkRBDQA#3uqNxzA8sTrARrJsBswUleYMtgsdBusyIUmdZVf8ezY
        - https://mega.nz/file/EW8kRQ4K#rPXWZg9xo1I_V06C-4J5dO2CQNL4Byu_5SGlHfcafuM
        - https://mega.nz/file/IfEGBRCZ#CK_AqWN9tRKBIzurkxN5UVfUsJOK38_MYxhnbeG1f_0
        - https://mega.nz/file/sfczASTC#HbN_l_q9Jc4dA99nj1YYzyJj6bMVtOSNOWX1S2R_EXk
        - https://mega.nz/file/NLtnhIaB#s6GH_T9RQI6IouOZKCWhsFilZUcbz4ew3f1riEKNS1I
    runs-on: ubuntu-latest
    steps:
    - uses: actions/cache@v4
      id: cache
      with:
        path: megatools-1.11.1.20230212-linux-x86_64
        key: megatools-1.11.1.20230212-linux-x86_64
    - name: Mega
      if: steps.cache.outputs.cache-hit != 'true'
      run: |
        curl -OL https://megatools.megous.com/builds/builds/megatools-1.11.1.20230212-linux-x86_64.tar.gz
        tar xvf *.gz
    - name: Leech
      run: |
        mkdir leech
        megatools*/megatools dl --path leech/ ${{ matrix.url }}
        cd leech
        find . -size +1960M -exec split -b 1G --numeric-suffixes=1 {} {}.0 \;
        find . -size +1960M -exec rm {} \;
    - name: Upload
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: leech/*
        tag: latest
        overwrite: true
        file_glob: true
