name: leech

on:
  push:
    paths:
    - '.github/workflows/leech.yml'

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        url:
        - https://mega.nz/file/BSNDWSia#Gs4GXAGjp5RmKJRueRGIIPdhAI0Y6sgobdQ8rhLxXCk
        - https://mega.nz/file/XBdGXZSD#WXvGRS32cSrUTwWRpYhAupdkxEnlT_NceBKOyqwTQbM
        - https://mega.nz/file/yRkRnSCJ#WXvGRS32cSrUTwWRpYhAupdkxEnlT_NceBKOyqwTQbM
        - https://mega.nz/file/AKl30CZS#T0kkubtANdUV1I0Zz8BKH2jP2NeZroCtzrgGNKgtBW8
        - https://mega.nz/file/ec9QRRhZ#8SDKDgVl3AcVqxy1m6l3tX-i_y7DlAW5BkiZ6NuDUYU
        - https://mega.nz/file/iF833DaA#iiYT5IQeNe3ejVjGYJJBitZ5gHyFPvFjks5rR2XImnE
        - https://mega.nz/file/rdVS1Z6L#8SDKDgVl3AcVqxy1m6l3tX-i_y7DlAW5BkiZ6NuDUYU
        - https://mega.nz/file/TRl3CR6R#iiYT5IQeNe3ejVjGYJJBitZ5gHyFPvFjks5rR2XImnE
        - https://mega.nz/file/9e8ixRiK#lbcRbs4H2AOZyv9h2DplmH3ErtRRBLysUcAjcvj7i9Q
        - https://mega.nz/file/fM8GxQCK#hS3EH1QSGNBbgxbpCKK9s4YtUORck5HDbwpd0kXyWuM
        - https://mega.nz/file/4W0CwThY#udItqwGNjIXl53DjNHeit3OEZtfpu_wfp--oIh1m8D8
        - https://mega.nz/file/mIsw2JYY#-5EdrW-1F_dgWsvOEEtci8Uv_UsIGs0EYDXVnD9jj-U
        - https://mega.nz/file/PRdyBRhZ#E0pXnayblYKC-qQt_6G5pL15kbYLkUJw-XPKMQu-dX4
        - https://mega.nz/file/xb11VToA#BSfNZrk7XjOL5sftFpCrd6OSlBNUwfvN-QDy9WIT08o
        - https://mega.nz/file/0KtxFS6R#nLnbYDXsTcmtwlsujhya2RqbqlSuayZwL7c8WkhoDyU
        - https://mega.nz/file/4XlxjJgY#HqVR02nYmJCBvY54w13rT9YwezDN-q4Kt6QHm0_HwEQ
        - https://mega.nz/file/PZ9HRSSQ#9YrR26hkx7Dum46xJVyYp5SOYUNneaPH_3TCxx48FFQ
        - https://mega.nz/file/1X0U1S7J#O-l01pg_rjgxRyKWsnREo_Z-a9kR4eY2G1Vma81pJzo
        - https://mega.nz/file/uZ8RSDZS#12puomhU6P2bv9IKsyhxXwV9fW-lS43P5pXnUCJxb7g
        - https://mega.nz/file/nNUjgIKI#pnNUakPQbxyByX4Wa-aAgmvC1agj5IrTQ9f8KkdvMqo
        - https://mega.nz/file/obk0lSpT#g5OrRu-blvDfyRTkInOEqBj2CPU88d6kUtCh46RPkHs
        - https://mega.nz/file/nEVxgQIZ#f6YzXOEgLwjqR-I0pKS_TIi9k0TU_IbrXdepbbV9Lh0
        - https://mega.nz/file/ADsBGISS#yuiBcPF5DONrSVVrCco6M_U9FUpN-uueJSzbMJi5K7Q
        - https://mega.nz/file/rQ1wFKzL#39nMv0c09L2uW_d53hr4Woxkh3eLBIg2ZTzP3Ksp9Pg
        - https://mega.nz/file/yY1gELhJ#53ofsmTAhL-gKsN13m2lK6rq1jozU3HeeIrXidRVt-Y
    runs-on: ubuntu-latest
    steps:
    - uses: actions/cache@v3
      id: cache
      with:
        path: megatools-1.11.1.20230212-linux-x86_64
        key: megatools-1.11.1.20230212-linux-x86_64
    - name: Mega
      if: steps.cache.outputs.cache-hit != 'true'
      run: |
        curl -OL https://megatools.megous.com/builds/builds/megatools-1.11.1.20230212-linux-x86_64.tar.gz
        tar xvf *.gz
    - name: Leech
      run: |
        mkdir leech
        megatools*/megatools dl --path leech/ ${{ matrix.url }}
        cd leech
        find . -size +2G -exec split -b 1G --numeric-suffixes=1 {} {}.0 \;
        find . -size +2G -exec rm {} \;
    - name: Upload
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: leech/*
        tag: latest
        overwrite: true
        file_glob: true
