name: leech

on:
  push:
    paths:
    - '.github/workflows/leech.yml'

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        url:
        - https://mega.nz/file/rccAwB6b#r8UlHRHvH6gqH_ibAjc8uctg6lAQ2bfQM0QqSnsJwlI
        - https://mega.nz/file/aEkkUYCI#v13QtsucYnx2v5YCD7jamdAnFUqB3YmFGmAmBhx4JOA
        - https://mega.nz/file/WJ4AGaZQ#S0HcwXhtgpns2GUG2g8G8pUiw5f9f0iN_gWTB0_f4To
        - https://mega.nz/file/yElTTDSD#OmaFVsqT2NWrItdVAMcQxm7-YnJVZCmKi0n3PwcVlPQ
        - https://mega.nz/file/jB0DRTST#v13QtsucYnx2v5YCD7jamdAnFUqB3YmFGmAmBhx4JOA
        - https://mega.nz/file/jZlAzKQa#tr7GpmQMblPjSLOgWq5YpDV31O5tIq_o1xD1PAkquIA
        - https://mega.nz/file/yURW3JQL#B6WZ0DWUU4GefzCfHhdvXujvSbSQYb-z5U206m6AYJA
        - https://mega.nz/file/nR8kUbDL#B6i8aYL8nT-dHq0U6MxRBkPdEscS691ZBb4YDJRYYdk
        - https://mega.nz/file/uIdAybhT#43XHwqmJgJSwEiWvvfuIxqJWzyWeFKfW9-VrBeksqPo
        - https://mega.nz/file/qMFmgI5C#IET9OSOosWKwnWIZ9ChmeLivqQCWYAi2rHWL3OaWsig
        - https://mega.nz/file/Na1UyQgL#irsSvNbvkmuFhxt68vWkZIoj4KvlstHNucnIE-R_T3A
        - https://mega.nz/file/zdMSVI6C#stQghze2ImDHIy6mI-MsOYc1uEdx0jesUSt8eagLx5o
        - https://mega.nz/file/vZpjgZ7C#dFm8hl9bll3F9ykkdc0pSRyD9nWb04Z9ikGHCiD-sG8
        - https://mega.nz/file/SdNSgJII#wfdL73ylY0R0WtW2x9h7CkWwO2c0jexzapCHbS7Get0
        - https://mega.nz/file/uAUnSJ7A#LNp2gqMXjLEJ5_A1_UVlSl758bxCNOt9Rpv8Hy9WO1Q
        - https://mega.nz/file/zQFVQJob#hp9oGO_I3WypvvNBpOuX4jh6mgZiZ6oiem5Io3sPw7I
        - https://mega.nz/file/PNMTECAC#U5upoiY8kVI6awnzha7Q5_PsRnrh6ymxeOoVwl9nBqo
        - https://mega.nz/file/XUk0AJaC#lRP71S0WwDM3CgPRIsN0hRQ6Sr6OSTP-_MNHDdFw0qw
        - https://mega.nz/file/XRcwzCzB#ozhV8uidrpUdsM5DpP0U0S-bP-i14JstYLpBMNI_c50
        - https://mega.nz/file/5LVWkDAC#Dum-lGMJdoeTjuBM8tcpuaLIuokZfFHuwcQkA-GOHDg
        - https://mega.nz/file/yRsA0YCb#GwINwC79kxc1JDZELJ560HTtDem-dJZLJT8XzhLRb5c
    runs-on: ubuntu-latest
    steps:
    - uses: actions/cache@v3
      id: cache
      with:
        path: megatools-1.11.1.20230212-linux-x86_64
        key: megatools-1.11.1.20230212-linux-x86_64
    - name: Mega
      if: steps.cache.outputs.cache-hit != 'true'
      run: |
        curl -OL https://megatools.megous.com/builds/builds/megatools-1.11.1.20230212-linux-x86_64.tar.gz
        tar xvf *.gz
    - name: Leech
      run: |
        mkdir leech
        megatools*/megatools dl --path leech/ ${{ matrix.url }}
        cd leech
        find . -size +2G -exec split -b 1G --numeric-suffixes=1 {} {}.0 \;
        find . -size +2G -exec rm {} \;
    - name: Upload
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: leech/*
        tag: latest
        overwrite: true
        file_glob: true
