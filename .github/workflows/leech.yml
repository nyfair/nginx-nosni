name: leech

on:
  push:
    paths:
    - '.github/workflows/leech.yml'

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        url:
        - https://mega.nz/file/4GEzBJjB#89jINsQu7ffleEsU-EViXOUwc633Dx0u5SQ_pna_IL8
        - https://mega.nz/file/dK8ngQ5K#8dNHPXvdTqvFqpoelWHqapjBvgQ40ufBr2soxUttrx8
        - https://mega.nz/file/oOUFXQ6R#mqmjshPnIj3hCE0dUV0QwYTTSRo-o9_qN3-9R-8zwDc
        - https://mega.nz/file/YbVFWIaB#epsim4VALbiKjg1_VxtAVHzyT2iBIMzfWaec-8HGwjA
        - https://mega.nz/file/wLUFGYgL#CdFxbDJnwFVF_xcWoBYaMvjOPvHYMT1kS1bL2tzNJBk
        - https://mega.nz/file/BC11nYYa#8jOagO6-hpA6-En7R-xwbDpuXVk_NN6l5TzPfaC2YVU
        - https://mega.nz/file/NbMm2J5A#sdevAUEj45k0Pt2ao3CztjrVWggS2xViE_7f_G5JOag
        - https://mega.nz/file/MHtTDBRI#kxxLLMCwYP2a_O6Ex9HgCyKFCdHTK3LbFvMJTUYXKuY
        - https://mega.nz/file/JT9SBDCa#CPSwHn7GWrXmW-wwM1RcJi8K3h-CaYM-F3MH_snTx3o
        - https://mega.nz/file/UekTARyb#53LkvNnc7tvtjxLAAS9p5wGbBIG_DX5W8vIQPAqykIc
        - https://mega.nz/file/hGVm1TBK#6ZrvU2lbGbrFxwDxYzf_8bRJCXIacJIlGEa1ZSrk2kA
        - https://mega.nz/file/8SkRyY4Y#Rh1yrXzIUIeasaqfA3PMqZ84Yjt8px7pRy7fXZV3Dl0
        - https://mega.nz/file/4OV2CSrZ#oYoe3s-qyC1zxAmNhYwyWX-if8SVHugG5OnIztgAEUo
        - https://mega.nz/file/wHFggTTK#clfvCImPHb3KQ1l3BoRT5pQ3O_K1uF6OuYsrAGNdaZM
        - https://mega.nz/file/Qa0AQZQB#xb5aE3c_x3lHMpdhmAAw5GjkYuAxPDIK4oS-keUaeRE
        - https://mega.nz/file/ZCsRFDRL#WSdIFFeU-wRsQp_HtltXsf7DEmh1RhR3-zG7O_bIuNs
        - https://mega.nz/file/1PF23RJB#ATXmwXPb4ovKHT11LqSyffX2GxU4Tlw_STyUDAoP0Vw
        - https://mega.nz/file/Ae0GwQAL#ATXmwXPb4ovKHT11LqSyffX2GxU4Tlw_STyUDAoP0Vw
        - https://mega.nz/file/QOUWQKwZ#f6dz3QQlmRtK0BD8Wp0tRzw-K0VnQJHfNjfm5fPEnx8
        - https://mega.nz/file/lb9ADJoI#K5TNZTI-f1rFxkvTjJGjb-bZBKFfJ0eX9OCQNAGQzbk
        - https://mega.nz/file/MfdhlRjS#m1uRCdzN1qNNq5cmR5PJkx3g9CHTZ6qXVZl1i76Kb9c
        - https://mega.nz/file/AP82WBII#8wtDDjW_3gsNkitSoR4pFXya3q66a2PEpQfD9O7f5h4
        - https://mega.nz/file/4TEQiSSA#sjAZJ7wTi_G8V1iSi-yQ2xTMgUnrFDO_jHaCHKbzGS8
        - https://mega.nz/file/1aVEnCiI#WMVM1RdlU5msEPvckhoIKkIvVNRlx90XkXS_EHQujQ0
        - https://mega.nz/file/5KdCmLQJ#El9zjq5VgAjPPytB39nCU4jRoJQHqvLbImXRN6537Co
        - https://mega.nz/file/NC9QUBIA#RgrDj0SMwRGUrVVnznx1l15Io1jILbDIlX0BsXQGTSM
        - https://mega.nz/file/EPNQFBgS#hFHzl35fvYMfBWrOIMAyijm9Sz3LV7OcYgoseW6qzso
    runs-on: ubuntu-latest
    steps:
    - uses: actions/cache@v3
      id: cache
      with:
        path: megatools-1.11.1.20230212-linux-x86_64
        key: megatools-1.11.1.20230212-linux-x86_64
    - name: Mega
      if: steps.cache.outputs.cache-hit != 'true'
      run: |
        curl -OL https://megatools.megous.com/builds/builds/megatools-1.11.1.20230212-linux-x86_64.tar.gz
        tar xvf *.gz
    - name: Leech
      run: |
        mkdir leech
        megatools*/megatools dl --path leech/ ${{ matrix.url }}
        cd leech
        find . -size +1960M -exec split -b 1G --numeric-suffixes=1 {} {}.0 \;
        find . -size +1960M -exec rm {} \;
    - name: Upload
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: leech/*
        tag: latest
        overwrite: true
        file_glob: true
