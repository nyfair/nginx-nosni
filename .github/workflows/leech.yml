name: leech

on:
  push:
    paths:
    - '.github/workflows/leech.yml'

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        url:
        - https://mega.nz/file/gOcjgRYR#yoKJ7EEv4QtZ2m7JCqFv67g14jJoDlHRGl08dI5-TXs
        - https://mega.nz/file/sDNgEBCB#nPXTjUMZvcQkPnoMKFxAjpZjIRQiJH4bKlhsEqzYs7I
        - https://mega.nz/file/0eFH3Y4J#qbo4q-bwMroUZEdloVlgHQOiRNoT0X0tsz8wV3sausE
        - https://mega.nz/file/QKFxzIIC#HsXIoE9lG-FvergvfUsxIYdASwYwTnAHxYMgqj6K0tc
        - https://mega.nz/file/0GkWxbTB#TjdylbsHXqVHOCyrTyL4oiLLDjfPG5nqbAFdImT7TP8
        - https://mega.nz/file/0fVSBSxI#mkLQ40ppP9jMe5gx206N4DlbFPk6FtcB39exAhhSKd0
        - https://mega.nz/file/ZP0VSCDY#s0EBEW6nvdLKM4SVfSBOLxIAsuDWloqFsfQ5DYy7QnM
        - https://mega.nz/file/QXllGbIb#t63QwVcK5hfKIJVMtVGGCLAyqF-XE8UvNzeyz6m64Rg
        - https://mega.nz/file/oDM0WDLa#H81wkDfVO12Pn1h_csaxIlmqGNDclCZ2Uz5fhwVU-TE
        - https://mega.nz/file/BCUFwZqL#fYtrPdjwrFkvX12xuwMCAOWp-ErE1pY_uyve-z9EERw
        - https://mega.nz/file/NHMFjSLD#Z5tNPAbxhoigGoK_NKR3XUnosyo0arE0PyTO4S-0Qf0
        - https://mega.nz/file/QHc2DQJb#Dx2ZhUNBNaAFAq73oKDhJBfHe4VUFvxOjzj0ZTi6kBA
        - https://mega.nz/file/QT8AmZbY#MZ7lpnRR69qZttwceUVbzvwksHaXKI_P2qVlFGwIiG0
        - https://mega.nz/file/kPsgjbyZ#Bhm6ye_pDA8xC1fYP7svKTkSlLAkzSqyc1ot1dAkQdw
        - https://mega.nz/file/lDFHxbLB#6Izu1-z8fvHylUf95tAWLdVho6_PTh9t0YkjdiHwCh0
        - https://mega.nz/file/RHEngbRL#IebMg0Gjs9sEeBqkaIbFzkh4aJe_EUGQg6pGAyPiesQ
        - https://mega.nz/file/QDVwyB6T#AmQsH_BwjXHQ1vK6AfMpFHuoqJlXQr-y9ZYQ8oe76jA
        - https://mega.nz/file/BHMlkZrC#jgDX-2UoKYc8FUMKphI3wXap9K5yk4RSKKWnVkTPx-Y
        - https://mega.nz/file/EKVXzRqC#kCnmgnC-kJ5_2QRoBsMC8K96tlnuFxOfnVJWs9bjSUE
        - https://mega.nz/file/pGNCzATB#qFiXxbNk-SVoRvK4x-bOPZi-jo4gn6FA0JBt4m27Dds
        - https://mega.nz/file/IH913KjY#9S4wk-GwPIqpLm8gq-mFryWhzQ1RspCLcO59XSr9c4Q
        - https://mega.nz/file/xftnUR5I#ypTFsQMY-DnREdAzdUi5mR1cSjVizO5kdkLbSIEZipc
        - https://mega.nz/file/9W0mzYQJ#ixKoty4vBfr7DNri26mYjvvvQ2UyHgi6-1nUQ7OluX0
        - https://mega.nz/file/NTUmEaTD#1ZA0jUATltBipOIjfCRtorAvpWX5WXEZNz_il-ANOQs
        - https://mega.nz/file/5D1WRKBZ#Omn2EZjNnCkXBZ51hxrwaTdHwC-Z2sJ4aGkFSewGYD8
    runs-on: ubuntu-latest
    steps:
    - uses: actions/cache@v4
      id: cache
      with:
        path: megatools-1.11.1.20230212-linux-x86_64
        key: megatools-1.11.1.20230212-linux-x86_64
    - name: Mega
      if: steps.cache.outputs.cache-hit != 'true'
      run: |
        curl -OL https://megatools.megous.com/builds/builds/megatools-1.11.1.20230212-linux-x86_64.tar.gz
        tar xvf *.gz
    - name: Leech
      run: |
        mkdir leech
        megatools*/megatools dl --path leech/ ${{ matrix.url }}
        cd leech
        find . -size +1960M -exec split -b 1G --numeric-suffixes=1 {} {}.0 \;
        find . -size +1960M -exec rm {} \;
    - name: Upload
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: leech/*
        tag: latest
        overwrite: true
        file_glob: true
